<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map with Multiple GeoJSON Layers, Dynamic Legend, and City Manager</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Leaflet MiniMap CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.css" />
    <!-- Open Sans Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap">
    <style>
    /* General style settings */
    body {
        margin: 0;
        padding-bottom: 50px;
        height: 100vh;
        overflow: hidden;
        font-family: 'Open Sans', sans-serif;
    }
    /* Grid layout */
    .container {
        display: grid;
        grid-template-columns: 20% 1fr;
        grid-template-rows: auto 1fr;
        gap: 10px;
        grid-template-areas:
            "Logo Map"
            "Side-Bar Map";
        height: calc(100vh - 40px);
        width: 100vw;
        overflow: hidden; /* Taşan içeriği gizle */
    }
    /* Logo style */
    .Logo {
        grid-area: Logo;
        background-color: white;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 10px;
    }
    .Logo img {
        max-width: 80%;
        max-height: 80%;
    }
    /* Side-Bar style */
    .Side-Bar {
        grid-area: Side-Bar;
        background-color: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        overflow-y: auto;
    }
    .Side-Bar h1 {
        font-weight: bold;
        font-size: 12pt;
        margin: 0;
        text-align: ;
    }
    .Side-Bar p {
        font-size: 9pt;
        margin: 0;
        text-align: justify;
    }
    /* Map container style */
    .map-container {
        grid-area: Map;
        position: relative;
        height: 100%;
        width: 100%;
        overflow: hidden; /* Taşan içeriği gizle */
    }
    .map-container .leaflet-container {
        height: 100%;
        width: 100%;
    }
    
    /* Legend style */
    .legend {
        background-color: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        line-height: 1.5;
        max-height: calc(100% - 20px);
        overflow-y: auto;
    }
    .legend h4 {
        margin: 0 0 10px;
        font-size: 14px;
    }
    
    /* City manager style */
    #city-manager {
        position: absolute;
        top: 10px;
        left: 50px;
        z-index: 1000;
        background-color: white;
        padding: 5px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    #city-manager label {
        font-weight: 600;
        font-size: 10pt;
    }
    #city-manager select {
        width: 100%;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
        .geojson-label {
            background-color: transparent;
            border: none;
            box-shadow: none;
            font-family: 'Open Sans', sans-serif;
            font-weight: bold;
            font-size: 12px;
            color: red;
            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
        }

        /* Media queries */
    @media (max-width: 768px) {
        .container {
            grid-template-columns: 1fr;
            grid-template-rows: auto auto 1fr;
            grid-template-areas:
                "Logo"
                "Side-Bar"
                "Map";
        }
        .Logo {
            justify-content: ;
            align-items: ;
            height: 80px;
        }
        .Side-Bar {
            max-height: 30vh;
            overflow-y: auto;
        }
        .map-container {
            height: calc(70vh - 80px);
        }
    }
</style>
</head>
<body>
    <svg width="0" height="0">
    <defs>
        <pattern id="hatchPattern" width="5" height="10" patternUnits="userSpaceOnUse">
            <path d="M5,0 L5,10" style="stroke:#3e3e3e; stroke-width:0.75" />
        </pattern>
    </defs>
</svg>

    <div class="container">
        <!-- Logo Area -->
        <div class="Logo">
            <img src="https://upload.wikimedia.org/wikipedia/tr/4/40/Tarihi_Kentler_Birli%C4%9Fi_logo.png" alt="Logo">
        </div>
        <!-- Side Panel (Side-Bar) -->
        <div class="Side-Bar">
            <h1>Tarihi Kentler Birliği</h1>
            <p>
                Bu haritanın açıklaması burada yer alır. Açıklamanın bu kısmı yer doldurucu metin olarak kullanılıyor ve sola yaslanarak hizalanmıştır.
                Açıklama kısmı sayfa düzenini ve içerik akışını koruyacak şekilde tasarlanmıştır.
                Bu haritanın açıklaması burada yer alır. Açıklamanın bu kısmı yer doldurucu metin olarak kullanılıyor ve sola yaslanarak hizalanmıştır.
                Açıklama kısmı sayfa düzenini ve içerik akışını koruyacak şekilde tasarlanmıştır.
            </p>
        </div>
        <!-- Map Container -->
        <div class="map-container">
            <div id="map"></div>
            <!-- City Manager -->
            <div id="city-manager">
                <label for="cities">Şehirler:</label>
                <select id="cities">
                    <!-- "Şehir seçiniz" option will be shown by default -->
                </select>
            </div>
        </div>
    </div>
        <!-- Map Container -->
        <div class="map-container">
            <div id="map"></div>
        </div>
    </div>
    <!-- Turf JS -->
    <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Leaflet MiniMap JS -->
    <script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>
    <script>
        // Map center and initial zoom level
        var centerCoordinates = [39.79273915299965, 36.01606133613108];
        var zoomLevel = 6;
        var minZoomLevel = 6;

        // Map bounds (Turkey)
        var southWest = L.latLng(33.5, 25.0);
        var northEast = L.latLng(45, 46.0);
        var bounds = L.latLngBounds(southWest, northEast);

        // Create the map
        var map = L.map('map', {
            center: centerCoordinates,
            zoom: zoomLevel,
            minZoom: minZoomLevel,
            layers: [],
            maxBounds: bounds,
            maxBoundsViscosity: 1.0
        });

        // Base layer
        var baseLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/light_nolabels/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://carto.com/">Carto</a>',
            noWrap: true
        }).addTo(map);

        // GeoJSON Layers
        var geoJSONLayers = {
            "Layer 1": null,
            "Layer 2": null,
            "Layer 3": null,
            "Layer 4": null,
            "Layer 5": null
        };

        // Function to load GeoJSON layers
        function loadGeoJSONLayer(name, url, style, labelProperty, useHatchPattern = false) {
    fetch(url)
        .then(response => response.json())
        .then(data => {
            geoJSONLayers[name] = L.geoJSON(data, {
                style: function (feature) {
                    let appliedStyle = { ...style };
                    
                    if (useHatchPattern) {
                        appliedStyle.fillColor = 'url(#hatchPattern)';
                        appliedStyle.fillOpacity = 1;
                    }

                    return appliedStyle;
                },
                onEachFeature: function (feature, layer) {
                    if (feature.properties && feature.properties[labelProperty]) {
                        let labelPoint;

                        if (feature.geometry.type === 'MultiPolygon') {
                            // Find the largest polygon
                            let largestPolygon = feature.geometry.coordinates.reduce((largest, polygon) => {
                                let area = turf.area(turf.polygon(polygon));
                                return area > largest.area ? { polygon, area } : largest;
                            }, { polygon: null, area: 0 }).polygon;

                            labelPoint = turf.centroid(turf.polygon(largestPolygon));
                        } else {
                            // For single polygons or other geometry types
                            labelPoint = turf.centroid(feature);
                        }

                        L.marker(
                            [labelPoint.geometry.coordinates[1], labelPoint.geometry.coordinates[0]],
                            {
                                icon: L.divIcon({
                                    className: 'geojson-label',
                                    html: feature.properties[labelProperty]
                                }),
                                interactive: false
                            }
                        ).addTo(map);
                    }
                }
            });
            updateLayerControl();
            geoJSONLayers[name].addTo(map); // Add layer to map by default
        });
}

        // Load GeoJSON layers (replace with your GitHub URLs)
        
        loadGeoJSONLayer("Tüm İl Sınırları", "https://raw.githubusercontent.com/mihracnar/Leaflet-Map-with-Multiple-Geojson-Layers-Dynamic-Legend-and-City-Manage-Public/3a77412da592008be7669bae5f6c03db379f4897/Geojson/tum_iller_simplified.geojson", {
        color: 'red', // Dış sınır rengi
        weight: 1, // Sınır kalınlığı
        dashArray: '2, 2', // Kısa çizgiler
        opacity: 0.45,
        fillColor: 'transparent', // İç renk, 'transparent' olarak ayarlandı
        fillOpacity: 0 // İç opaklık, görünmemesi için 0
        }, 'City', false);
        
        loadGeoJSONLayer("Üye Büyükşehirler", "https://raw.githubusercontent.com/mihracnar/Leaflet-Map-with-Multiple-Geojson-Layers-Dynamic-Legend-and-City-Manage-Public/main/Geojson/uye_buyuksehir.geojson", {
        color: 'grey',
        weight: 0,
        dashArray: '5, 5',
        opacity: 0,
        fillColor: 'grey',
        fillOpacity: 0.2
        }, 'your-label-property', true);
        
        // Add more layers as needed
        
        // Layer Control
        var baseMaps = {
            "Carto Light No Labels": baseLayer
        };

        var overlayMaps = {};

        function updateLayerControl() {
            if (map.layerControl) {
                map.removeControl(map.layerControl);
            }
            for (var key in geoJSONLayers) {
                if (geoJSONLayers[key]) {
                    overlayMaps[key] = geoJSONLayers[key];
                }
            }
            map.layerControl = L.control.layers(baseMaps, overlayMaps, {position: 'topright', collapsed: false}).addTo(map);
        }

        // Legend control
        var legend = L.control({position: 'bottomright'});

        legend.onAdd = function(map) {
            var div = L.DomUtil.create('div', 'legend');
            div.innerHTML = '<h4>Lejant</h4>';
            return div;
        };

        legend.addTo(map);

        function updateLegend() {
        var legendDiv = document.querySelector('.legend');
        legendDiv.innerHTML = '<h4>Lejant</h4>';
        map.eachLayer(function(layer) {
        if (layer instanceof L.GeoJSON) {
            var layerName = getLayerName(layer);
            if (layerName) {
                var style = layer.options.style;
                var color = typeof style === 'function' ? style().color : style.color;
                var fillColor = typeof style === 'function' ? style().fillColor : style.fillColor;
                var weight = typeof style === 'function' ? style().weight : style.weight;
                var dashArray = typeof style === 'function' ? style().dashArray : style.dashArray;

                var legendItem = document.createElement('div');
                legendItem.style.marginBottom = '5px';

                if (fillColor === 'url(#hatchPattern)') {
                    // Taramalı polygon için
                    legendItem.innerHTML = `
                        <svg width="20" height="20" style="vertical-align: middle;">
                            <rect width="20" height="20" fill="url(#hatchPattern)" stroke="grey" stroke-width="1"/>
                        </svg>
                        <span style="margin-left: 5px;">${layerName}</span>
                    `;
                } else if (weight > 0 && fillColor === 'transparent') {
                    // Sadece dış çizgili polygon için
                    legendItem.innerHTML = `
                        <svg width="20" height="20" style="vertical-align: middle;">
                            <rect width="20" height="20" fill="none" stroke="${color}" stroke-width="${weight}" stroke-dasharray="${dashArray}"/>
                        </svg>
                        <span style="margin-left: 5px;">${layerName}</span>
                    `;
                }

                legendDiv.appendChild(legendItem);
            }
        }
    });
}

        function getLayerName(layer) {
            for (var name in geoJSONLayers) {
                if (geoJSONLayers[name] === layer) {
                    return name;
                }
            }
            return null;
        }

        map.on('overlayadd', function() {
            updateLegend();
        });

        map.on('overlayremove', function() {
            updateLegend();
        });

        // Mini Map
        var miniMapLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/light_nolabels/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://carto.com/">Carto</a>'
        });

        new L.Control.MiniMap(miniMapLayer, {
            toggleDisplay: true,
            minimized: false,
            position: 'bottomleft'
        }).addTo(map);

        // Cities (Bookmark) Manager
        var cities = {
            "Şehir seçiniz": {center: centerCoordinates, zoom: zoomLevel},
            "İstanbul": {center: [41.0082, 28.9784], zoom: 10},
            "Ankara": {center: [39.9334, 32.8597], zoom: 10},
            "İzmir": {center: [38.4192, 27.1287], zoom: 11},
            "Antalya": {center: [36.8841, 30.7056], zoom: 11},
            "Adana": {center: [37.0017, 35.3289], zoom: 11}
        };

        var citySelect = document.getElementById('cities');

        var defaultOption = document.createElement('option');
        defaultOption.value = "";
        defaultOption.textContent = "Şehir seçiniz";
        defaultOption.selected = true;
        citySelect.appendChild(defaultOption);

        Object.keys(cities).forEach(function(name) {
            if (name !== "Şehir seçiniz") {
                var option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                citySelect.appendChild(option);
            }
        });

        citySelect.addEventListener('change', function() {
            var selectedCity = citySelect.value;
            var city = cities[selectedCity];
            if (city) {
                map.setView(city.center, city.zoom);
            }
        });
    </script>
</body>
</html>
